<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Panda Poop Flappy</title>
    <style>
        body {
            margin: 0;
            background: #87ceeb;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            position: relative;
        }
        
        canvas {
            background: linear-gradient(#cceeff, #e6f7ff);
            border: 3px solid #222;
        }
        
        #restartBtn {
            position: absolute;
            top: 65%;
            padding: 12px 28px;
            font-size: 18px;
            background: #222;
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: none;
        }
    </style>
</head>

<body>

    <canvas id="game" width="400" height="600"></canvas>
    <button id="restartBtn">Restart</button>

    <script>
        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");
        const restartBtn = document.getElementById("restartBtn");

        /* ---------- GAME STATE ---------- */
        let panda, pipes, poops, splats, frame, gameOver, score;

        const gravity = 0.45;
        const jumpPower = -8;

        /* ---------- AUDIO ---------- */
        const audioCtx = new(window.AudioContext || window.webkitAudioContext)();

        function fartSound() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = "sawtooth";
            osc.frequency.setValueAtTime(90, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.25, audioCtx.currentTime);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.25);
            osc.stop(audioCtx.currentTime + 0.3);
        }

        /* ---------- INIT ---------- */
        function init() {
            panda = {
                x: 100,
                y: 260,
                v: 0
            };
            pipes = [];
            poops = [];
            splats = [];
            frame = 0;
            score = 0;
            gameOver = false;
            restartBtn.style.display = "none";
        }
        init();

        /* ---------- INPUT ---------- */
        function dropPoop() {
            fartSound();
            poops.push({
                x: panda.x - 10,
                y: panda.y + 35,
                v: 2
            });
        }

        function jump() {
            if (gameOver) return;
            panda.v = jumpPower;
            dropPoop();
        }

        document.addEventListener("keydown", e => {
            if (e.code === "Space") jump();
        });

        canvas.addEventListener("click", jump);

        // Right click = extra poop ðŸ’©
        canvas.addEventListener("contextmenu", e => {
            e.preventDefault();
            if (!gameOver) dropPoop();
        });

        /* ---------- RESTART ---------- */
        restartBtn.onclick = () => {
            init();
            update();
        };

        /* ---------- PIPES ---------- */
        function createPipe() {
            let gap = 190;
            let top = Math.random() * 220 + 40;
            pipes.push({
                x: canvas.width,
                top,
                bottom: canvas.height - top - gap,
                passed: false
            });
        }

        /* ---------- DRAW PANDA ---------- */
        function drawPanda() {
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.ellipse(panda.x, panda.y, 22, 26, 0, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = "#f2f2f2";
            ctx.beginPath();
            ctx.ellipse(panda.x, panda.y + 8, 12, 14, 0, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.arc(panda.x - 16, panda.y - 22, 8, 0, Math.PI * 2);
            ctx.arc(panda.x + 16, panda.y - 22, 8, 0, Math.PI * 2);
            ctx.fill();

            ctx.beginPath();
            ctx.ellipse(panda.x - 8, panda.y - 6, 6, 8, 0, 0, Math.PI * 2);
            ctx.ellipse(panda.x + 8, panda.y - 6, 6, 8, 0, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(panda.x - 8, panda.y - 6, 2, 0, Math.PI * 2);
            ctx.arc(panda.x + 8, panda.y - 6, 2, 0, Math.PI * 2);
            ctx.fill();
        }

        /* ---------- POOP + BONUS ---------- */
        function drawPoop() {
            ctx.fillStyle = "#6b3e26";

            poops.forEach(p => {
                p.v += 0.25;
                p.y += p.v;

                ctx.beginPath();
                ctx.arc(p.x, p.y, 6, 0, Math.PI * 2);
                ctx.fill();

                pipes.forEach(pipe => {
                    if (!pipe.bonus &&
                        p.x > pipe.x &&
                        p.x < pipe.x + 50 &&
                        p.y > pipe.top &&
                        p.y < canvas.height - pipe.bottom
                    ) {
                        score += 2; // ðŸ’¥ bonus
                        pipe.bonus = true;
                    }
                });

                if (p.y > canvas.height - 20) {
                    for (let i = 0; i < 6; i++) {
                        splats.push({
                            x: p.x,
                            y: canvas.height - 20,
                            vx: (Math.random() - 0.5) * 3,
                            vy: Math.random() * -3,
                            life: 30
                        });
                    }
                    p.dead = true;
                }
            });

            poops = poops.filter(p => !p.dead);
        }

        function drawSplatter() {
            ctx.fillStyle = "#5a2e1a";
            splats.forEach(s => {
                s.x += s.vx;
                s.y += s.vy;
                s.vy += 0.15;
                s.life--;
                ctx.beginPath();
                ctx.arc(s.x, s.y, 3, 0, Math.PI * 2);
                ctx.fill();
            });
            splats = splats.filter(s => s.life > 0);
        }

        /* ---------- PIPES ---------- */
        function drawPipes() {
            ctx.fillStyle = "#228B22";
            pipes.forEach(p => {
                ctx.fillRect(p.x, 0, 50, p.top);
                ctx.fillRect(p.x, canvas.height - p.bottom, 50, p.bottom);
            });
        }

        function collision(p) {
            return (
                panda.x + 20 > p.x &&
                panda.x - 20 < p.x + 50 &&
                (panda.y - 25 < p.top ||
                    panda.y + 25 > canvas.height - p.bottom)
            );
        }

        /* ---------- GAME LOOP ---------- */
        function update() {
            if (gameOver) {
                ctx.fillStyle = "#000";
                ctx.font = "28px Arial";
                ctx.fillText("Game Over ðŸ’€", 110, 260);
                restartBtn.style.display = "block";
                return;
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            panda.v += gravity;
            panda.y += panda.v;

            if (panda.y < 0 || panda.y > canvas.height) gameOver = true;

            if (frame % 150 === 0) createPipe();

            pipes.forEach(p => {
                p.x -= 1.8;

                if (!p.passed && p.x + 50 < panda.x) {
                    score += 1; // âœ… passed pipe
                    p.passed = true;
                }

                if (collision(p)) gameOver = true;
            });

            pipes = pipes.filter(p => p.x + 50 > 0);

            drawPoop();
            drawSplatter();
            drawPanda();
            drawPipes();

            ctx.fillStyle = "#000";
            ctx.font = "20px Arial";
            ctx.fillText("Score: " + score, 10, 30);

            frame++;
            requestAnimationFrame(update);
        }

        update();
    </script>

</body>

</html>